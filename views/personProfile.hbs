<style>
    .active {
        color: black;
    }
</style>

{{> header}}
<div class="m-10 flex justify-between">
    <!-- SideMenu -->
    <div class="mr-6 min-w-[16rem] w-64 flex-shrink-0 flex flex-col">
        <div>
            {{> sideMenu user=user}}
        </div>
        <div class="mt-4">
            {{> groups user=user}}
        </div>
    </div>
    <div class="flex-grow">
        <div class="flex flex-col border rounded-lg max-h-1/2">
            <div class="ml-8 flex-grow flex items-center">
                <img class="h-32 w-32 rounded-full m-8"
                    src="{{#if user.avatar}}{{user.avatar}}{{else}}images/avatar.png{{/if}}"
                    alt="{{user.avatar}}"></img>
                <div class="ml-8 mb-4 font-medium text-2xl">
                    {{#if user.name}}{{user.name}}{{else}}User Name{{/if}}
                </div>
                <div class="ml-auto flex ">
                    <div class="flex flex-col items-center mr-8">
                        <div class="text-3xl font-medium">
                            {{#if user.posts}}{{user.posts}}{{else}}0{{/if}}
                        </div>
                        <div>
                            Posts
                        </div>
                    </div>
                    <div class="flex flex-col items-center mr-8">
                        <div class="text-3xl font-medium">
                            {{#if user.followers}}{{user.followers.length}}{{else}}0{{/if}}
                        </div>
                        <div>
                            Followers
                        </div>
                    </div>
                    <div class="flex flex-col items-center mr-8">
                        <div class="text-3xl font-medium">
                            {{#if user.following}}{{user.following.length}}{{else}}0{{/if}}
                        </div>
                        <div>
                            Following
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex border-t p-3 font-medium text-gray-600">
                <div id="myPost" class="tab-btn mr-6 ml-6 cursor-pointer active">
                    My Post
                </div>
                <div id="editProfile" class="tab-btn mr-6 ml-6 cursor-pointer">
                    Edit Profile
                </div>
                <div id="yourReviews" class="tab-btn mr-6 ml-6 cursor-pointer">
                    Your Reviews
                </div>
                <div id="setting" class="tab-btn mr-6 ml-6 cursor-pointer">
                    Setting
                </div>
            </div>
        </div>
        <div class="flex mt-8">
            <div id="tab" class="flex-grow w-1/2 mr-6 flex flex-col">


            </div>
            {{> suggestedFriends user=user}}
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        const tab = 'My post';

        $('#myPost').on('click', function () {
            $('.tab-btn').removeClass('active');
            $(this).addClass('active');
            changeTab('My post');
        });

        $('#editProfile').on('click', function () {
            $('.tab-btn').removeClass('active');
            $(this).addClass('active');
            changeTab('Edit Profile');
        });

        $('#yourReviews').on('click', function () {
            $('.tab-btn').removeClass('active');
            $(this).addClass('active');
            changeTab('Your Reviews');
        });

        $('#setting').on('click', function () {
            $('.tab-btn').removeClass('active');
            $(this).addClass('active');
            changeTab('Setting');
        });

        //
        const post1 = { id: 1 };
        const post2 = { id: 2 };

        let renderData = '';

        function changeTab(tab) {
            switch (tab) {
                case 'My post':
                    renderData = `
                    <div class="w-full flex flex-col overflow-auto scroll-custom border rounded-lg" style="height:36rem">
                        {{!-- {{#each user.post}} --}}
                        {{> post post=post1}}
                        {{> post post=post2}}

                        {{!-- {{/each}} --}}
                    </div>
                    `
                    break;
                case 'Edit Profile':
                    renderData = `
                    <form id="user-form">
                        <div class="grid grid-cols-10 gap-8 pl-9">
                            <!-- Name -->
                            <div class="col-span-3 font-semibold text-lg text-black text-end pt-2">Name:</div>
                            <div class="col-span-7 text-lg text-gray-900 text-start">
                                <input
                                    type="text"
                                    name="name"
                                    class="w-full border rounded p-2"
                                    value="{{#if user.name}}{{user.name}}{{else}}User Name{{/if}}"
                                    required
                                />
                            </div>

                            <!-- Birthday -->
                            <div class="col-span-3 font-semibold text-lg text-black text-end pt-2">Birthday:</div>
                            <div class="col-span-7 text-lg text-gray-900">
                                <input
                                    type="date"
                                    name="birthday"
                                    class="w-full border rounded p-2"
                                    value="{{#if user.birthday}}{{user.birthday}}{{/if}}"
                                    required
                                />
                            </div>

                            <!-- Email -->
                            <div class="col-span-3 font-semibold text-lg text-black text-end pt-2">Email:</div>
                            <div class="col-span-7 text-lg text-gray-900">
                                <input
                                    type="email"
                                    name="email"
                                    class="w-full border rounded p-2"
                                    value="{{#if user.email}}{{user.email}}{{else}}User Email{{/if}}"
                                    required
                                />
                            </div>

                            <!-- Phone number -->
                            <div class="col-span-3 font-semibold text-lg text-black text-end pt-2">Phone number:</div>
                            <div class="col-span-7 text-lg text-gray-900">
                                <input
                                    type="text"
                                    name="phone"
                                    class="w-full border rounded p-2"
                                    value="{{#if user.phone}}{{user.phone}}{{else}}User Phone Number{{/if}}"
                                    required
                                />
                            </div>

                            <!-- Address -->
                            <div class="col-span-3 font-semibold text-lg text-black text-end pt-2">Address:</div>
                            <div class="col-span-7 text-lg text-gray-900">
                                <textarea
                                    name="address"
                                    class="w-full border rounded p-2"
                                    required
                                >{{#if user.address}}{{user.address}}{{else}}User Address{{/if}}</textarea>
                            </div>

                            <!-- Education -->
                            <div class="col-span-3 font-semibold text-lg text-black text-end pt-2">Education:</div>
                            <div class="col-span-7 text-lg text-gray-900">
                                <textarea
                                    name="education"
                                    class="w-full border rounded p-2"
                                    required
                                >{{#if user.education}}{{user.education}}{{else}}User Education{{/if}}</textarea>
                            </div>
                        </div>

                        <!-- Submit button -->
                        <div class="text-center mt-4">
                            <button type="submit" class="bg-blue-500 text-white px-4 py-2 rounded">
                                Save Changes
                            </button>
                        </div>
                    </form>

                    `
                    break;
                case 'Your Reviews':
                    //fetch data
                    const reviewers = [
                        {
                            username: 'nva',
                            avatar: '/images/avatar1.png',
                            review: 'good',
                        },
                        {
                            username: 'nvb',
                            avatar: '/images/avatar2.png',
                            review: 'bad',
                        },
                    ];
                    renderData = '';
                    reviewers.forEach(reviewer => {
                        renderData += `
                        <div class="comment flex p-4 border-b">
                            <img class="rounded-full w-12 h-12 mr-4" src="${reviewer.avatar}" alt="user-avatar">
                            <div class="rounded-xl flex-grow flex bg-gray-200 justify-between items-center">
                                <div class="rounded-xl p-2 pl-4 pr-4">
                                    <div class="font-bold">${reviewer.username}</div>
                                    <div>${reviewer.review}</div>
                                </div>
                                <div class="comment-like flex text-xl mr-2">
                                    <i class="fa-regular fa-thumbs-up mr-2 cursor-pointer"></i>
                                </div>
                            </div>
                        </div>
                        `
                    })

                    break;
                case 'Setting':
            }
            $('#tab').html(renderData);
        }

        // update user infomation
        $('#user-form').on('submit', function (e) {
            e.preventDefault(); 

            $.ajax({
                url: '/update-user',
                method: 'POST',
                data: $(this).serialize(), // Lấy tất cả dữ liệu từ form
                success: function (response) {
                    alert('User information updated successfully!');
                },
                error: function (err) {
                    console.error(err);
                    alert('Failed to update user information.');
                },
            });
        });

        changeTab(tab);
    });
</script>