{{!-- filepath: /e:/Hoc/Subjects on school/NMCNPM/Project/Source/Penet/views/partials/post.hbs --}}
<div data-post-id="{{post.id}}" class="w-full border flex flex-col rounded mb-4">
    <div class="flex justify-between border-b rounded p-4 w-full">
        <a href="/users/profile/{{post.user.id}}" class="flex items-center">
            <img class="rounded-full w-12 h-12 mr-4"
            src="{{#if post.user.avatar_url}}{{post.user.avatar_url}}{{else}}/images/avatar.png{{/if}}"
            alt="user-avatar">
            <div>
            <div class="font-medium text-xl fullName">
                {{post.user.first_name}} {{post.user.last_name}}
            </div>
            </div>
        </a>
        <div class="relative flex flex-col justify-end">
            <div class="post-more-btn flex justify-end cursor-pointer">
            <i class="fa-solid fa-ellipsis"></i>
            </div>
            <div 
            id="items" 
            class="absolute right-0 top-5 bg-white border rounded-xl shadow-lg 
            group-hover:block w-48 hidden"
            >
            {{#if (eq post.user.id user.id)}}
            <a href="#" id="edit-post" class="block px-4 py-2 text-gray-800 hover:bg-gray-200">
                <div class="flex items-center">
                <i class="fa-solid fa-pen-fancy"></i>
                <div class="ml-2"><span>Edit post</span></div>
                </div>
            </a>
            {{/if}}
            {{#if user.isAdmin}}
            <a href="#" class="delete-post-btn block px-4 py-2 text-gray-800 hover:bg-gray-200" data-id="{{post.id}}">
                <div class="flex items-center">
                <i class="fa-solid fa-trash-can"></i>
                <div class="ml-2"><span>Delete post</span></div>
                </div>
            </a>
            {{/if}}
            </div>
            <div>{{formatDate post.updatedAt}}</div>
        </div>
    </div>
    <div class="pl-8 pr-8 pt-4 pb-2">
        <div class="text-lg leading-relaxed text-gray-800">
            {{post.content}}
        </div>
    </div>
    <div class="pl-8 pr-8 pt-4 pb-2">
        {{#if post.attachments.length}}
            <div class="{{gridClass post.attachments.length}}">
                {{#each post.attachments}}
                <div class="max-h-96 bg-gray-200">
                    <img src="{{this.media_url}}" alt="post-attachment" class="w-full h-full rounded object-contain">
                </div>
                {{/each}}
            </div>
        {{/if}}
    </div>
    <div class="flex justify-between pl-8 pr-8">
        <div class="flex justify-between post-like m-8 text-3xl cursor-pointer">
            {{#if (includes post.dataValues.likes user.id)}}
            <i class="fa-solid fa-thumbs-up text-blue-600 fa-solid text-xl"></i>
            <div class="ml-4 text-xl like-count"> {{post.dataValues.likes.length}} </div>
            {{else}}
            <i class="fa-regular fa-thumbs-up text-xl"></i>
            <div class="ml-4 text-xl like-count"> 0 </div>
            {{/if}}
            
        </div>

        <div class="post-comment flex items-center m-8 cursor-pointer rounded border-gray-400 w-36 text-xl">
            <div class="w-4">
                <i class="fa-regular fa-comment"></i>
            </div>
            <div class="ml-4 text-xl comment-count"> {{post.dataValues.comments.length}} </div>
        </div>
    </div>
</div>

<script>
  $(document).ready(() => {
    $('.delete-post-btn').on('click', async function() {
      const postId = $(this).data('id');
      console.log('Deleting post ID:', postId);
      if (confirm('Are you sure you want to delete this post?')) {
        try {
          const response = await fetch(`/posts/admin/${postId}`, {
            method: 'DELETE',
          });
          if (response.ok) {
            alert('Post deleted successfully');
            location.reload();
          } else {
            alert('Error deleting post');
          }
        } catch (error) {
          console.error('Error deleting post:', error);
          alert('Error deleting post');
        }
      }
    });
  });
</script>